# ======================================================================
# ctapipe-train-disp-reconstructor config file.
# version: VERSION
#
# Configuration for training machine-learning models
# ======================================================================

TrainDispReconstructor:
  random_seed: 0            # Seed used for sampling n_events for training.
  n_events:                 # The number of events used for training that can be provided
    - [type, "LST*", None]  # independently for each telescope type (e.g. "LST_LST_LSTCam").
    - [type, "MST*", None]  # If none, all events in the file are used.

  CrossValidator:
    n_cross_validations: 5
    rng_seed: 1337

  DispReconstructor:
    prefix: disp  # Prefix of the output generated by the DispReconstructor (Default: "disp")

    # All regression algorithms in scikit-learn are supported (https://scikit-learn.org/stable/modules/classes.html)
    norm_cls: ExtraTreesRegressor  # scikit-learn algorithm to be used for the norm(disp) models
    norm_config:                   # Settings passed to the scikit-learn algorithm
      n_estimators: 10
      max_depth: 10
      n_jobs: -1

    log_target: True  # If true, norm(disp) models predict log(norm(disp)) (output = exp(prediciton))

    # All classification algorithms in scikit-learn are supported (https://scikit-learn.org/stable/modules/classes.html)
    sign_cls: ExtraTreesClassifier  # scikit-learn algorithm to be used for the sign(disp) models
    sign_config:                    # Settings passed to the scikit-learn algorithm
      n_estimators: 10
      max_depth: 10
      n_jobs: -1

    QualityQuery:  # Event Selection performed before training the models
      quality_criteria:
      # - [<name>, <definition>]
        - ["HillasValid", "HillasReconstructor_is_valid"]
        - ["enough intensity", "hillas_intensity > 50"]
        - ["Positive width", "hillas_width > 0"]
        - ["enough pixels", "morphology_n_pixels > 3"]
        - ["not clipped", "leakage_intensity_width_2 < 0.5"]

    FeatureGenerator:  # On-the-fly generation of additional features
      features:        # Supported functions: "sin", "cos", "tan", "arctan2", "log", "log10", "exp", "sqrt"
      # - [<name>, <definition>]
        - ["area", "hillas_width * hillas_length"]

    features:
      - hillas_intensity
      - hillas_r
      - hillas_length
      - hillas_width
      - hillas_skewness
      - hillas_kurtosis
      - timing_slope
      - timing_deviation
      - leakage_intensity_width_1
      - leakage_intensity_width_2
      - leakage_pixels_width_1
      - leakage_pixels_width_2
      - concentration_cog
      - concentration_core
      - morphology_n_islands
      - morphology_n_large_islands
      - morphology_n_medium_islands
      - morphology_n_pixels
      - morphology_n_small_islands
      - peak_time_std
      - peak_time_skewness
      - peak_time_kurtosis
      - intensity_max
      - intensity_mean
      - intensity_std
      - intensity_skewness
      - intensity_kurtosis
      - ExtraTreesRegressor_energy      # Mean predicted energy of the array event
      - ExtraTreesRegressor_tel_energy  # Energy prediction for single telescope image
      - area  # Features generated by the FeatureGenerator still have to be listed here
              # for the models to use them.

    stereo_combiner_cls: "StereoMeanCombiner"  # No other combiners are implemented atm.
    StereoMeanCombiner:
      weights: None     # Options: None, intensity, konrad

